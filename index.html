<html>
  <head>
    <style>
      body {
        margin:5%;
        font-family:sans-serif;
      }
      #t {
        width:500px;
        height:300px;
      }
      .container{
        background-color:#eee;
      }
      .tabs {
        margin:0;
        padding:0;
      }
      .tabs li{
        float:left;
        list-style:none;
        margin:4px;
        background-color:silver;
      }
      .tabs a{
        display:block;
        padding:4px 16px 14px 16px;
        text-decoration:none;
        font-size:16px;
        color:black;
        -webkit-border-radius: 10px;
        border: 1px solid #000;
      }
      .builder {
        background-color:white;
        overflow:auto;
      }
      div, blockquote{
        margin:0;
        padding:0;
      }
      div {
        background-color:#cfc;
        margin:1px;
        padding:2px;
        xpadding-left:0;
      }
      blockquote{
        padding-left:15px;
      }
      .val{
        font-style:italic;
      }
      .key a, .val a{
        color:black;
        text-decoration:none;
      }
      .icon{
        display:block;
        float:right;
        text-decoration:none;
        padding-left:5px;
        color:blue;
      }
    </style>
    <script src="jquery-1.2.6.js"></script>
    <script>
      function JSONEditorBase() {
        this.TAB_SIZE = 30;
      }
      
      function JSONEditor(wrapped) {
        var self = this;
        
        this.wrapped = $(wrapped);

        this.wrapped.wrap('<div class="container"></div>');
        this.container = $(this.wrapped.parent());

        this.BRACE = function() { return $('<a class="icon" href="#"><strong>{</strong></a>') };
        this.BRACKET = function() { return $('<a class="icon" href="#"><strong>[</a>') };
        this.DELETE = function() { return $('<a class="icon" href="#"><img src="delete.png" /></a>') };
        this.ADD = function() {
          return $('<a class="icon" href="#"><img src="add.png" /></a>').click(function(e) {
            self.insert(this);
            return false;
          });
        };

        this.builderTab = $('<li><a href="#">builder</a></li>').click(function(e) {
          self.builder.show();
          self.wrapped.hide();
          return false;
        });
        
        this.textTab = $('<li><a href="#">text</a></li>').click(function(e) {
          self.builder.hide();
          self.wrapped.show();
          return false;
        });
        
        this.debugTab = $('<li><a href="#">debug</a></li>').click(function(e) {
          self.inspect(self.container);
          return false;
        });
        
        this.tabs = $('<ul class="tabs"></ul>');
        this.tabs.append(this.builderTab);
        this.tabs.append(this.textTab);
        this.tabs.append(this.debugTab);
        this.container.prepend(this.tabs);
                
        this.container.width(this.wrapped.width()).height(this.wrapped.height() + this.TAB_SIZE);
        this.container.css("position", "relative");

        this.builder = $('<div class="builder"></div>');
        this.container.append(this.builder);

        this.builder.css("position", "absolute").css("top", this.TAB_SIZE + "px").css("left", 0);
        this.builder.width(this.wrapped.width()).height(this.wrapped.height());
        
        this.wrapped.css("position", "absolute").css("top", this.TAB_SIZE + "px").css("left", 0);
        this.build(eval("("+this.wrapped.val()+")"), this.builder);
        
        return this;
      }
      JSONEditor.prototype = new JSONEditorBase();
      
      JSONEditor.prototype.edit = function(e){
        var input = document.createElement("INPUT");
        input.value = e.text();
        // input.onblur = function(){
        //   var val = input.value;
        //   e.text(val);
        //   e.get(0).editing = false;
        // }
        $(e).html(input);
        input.focus();
      };
      
      JSONEditor.prototype.inspect = function(e){
        var builder = this.builder.clone();
        $(".icon", builder).remove();
        $(".editable", builder).each(function(i){
          $(this).prepend('"');
          $(this).append('"');
        });
        var txt = builder.text();
        
        alert(txt);
      }
      
      // JSONEditor.prototype.insert = function(button){
      //   $(button.parentNode.nextSibling).append('<div>'+this.DELETE+this.BRACE+this.BRACKET+'<b class="key">'+
      //     this.editable("key")+'</b>:<span class="val">'+
      //     this.editable("value")+'</span> </div>'
      //   );
      // }

      JSONEditor.prototype.editable = function(text){
        var self = this;
        var clickFunc = function(e) {
          console.log(this.editing);
          if (!this.editing) {
            $(this).unbind("click", clickFunc);
            this.editing = true;
            self.edit($(this));
          }
          return true;
        };
        return $('<a class="editable" href="#"></a>').bind("click", clickFunc).text(text);
      }
      
      JSONEditor.prototype.build = function(json, node) {
        if(json instanceof Array){
          var bq = $(document.createElement("BLOCKQUOTE"));
          node.append(bq);
          this.build(json[0], bq);
          node.append($("<div>]</div>"));
        } else if (json instanceof Object){
            node.append($('<div>{</div>').prepend(this.DELETE()).prepend(this.ADD()));
          var bq = $(document.createElement("BLOCKQUOTE"));
          node.append(bq);
          for(var i in json){
            var div = $('<div></div>');
            div.append(this.DELETE());
            div.append(this.BRACE());
            div.append(this.BRACKET());
            div.append(this.editable(i).wrap('<b class="key"></b>').parent());
            div.append(document.createTextNode(': '));
            
            if(json[i] instanceof Array) {
              div.innerHTML += "[";
            } else if (json[i] instanceof Object) {
              //nothing
            } else{
              $(div).append(this.editable(json[i].toString()).wrap('<span class="val"></span>').parent());
            }
           
            bq.append(div);
            this.build(json[i], bq);
          }
          node.append($('<div>}</div>'));
        } else{
          // ignore, already handled
        }
      };
    </script>
    
    <script>
      $(document).ready(function(){
        var j = new JSONEditor($("#t"));
      });
    </script>
  </head>
  <body>
<textarea id="t">{
  "name": "a.title",
  "description": "foo.bar",
  "authors": [{
    "name": "p.foo",
    "link": "a | @href"
  }]
}
    </textarea>
  </body>  
</html>