<html>
  <head>
    <style>
      body {
        margin:5%;
        font-family:sans-serif;
      }
      #t {
        width:500px;
        height:300px;
      }
      .container{
        background-color:#eee;
      }
      .tabs {
        margin:0;
        padding:0;
      }
      .tabs li{
        float:left;
        list-style:none;
        margin:4px;
        background-color:silver;
      }
      .tabs a{
        display:block;
        padding:4px 16px 14px 16px;
        text-decoration:none;
        font-size:16px;
        color:black;
        -webkit-border-radius: 10px;
        border: 1px solid #000;
      }
      .builder {
        background-color:white;
        overflow:auto;
      }
      div, blockquote{
        margin:0;
        padding:0;
      }
      div {
        background-color:#cfc;
        margin:1px;
        padding:2px;
        xpadding-left:0;
      }
      blockquote{
        padding-left:15px;
      }
      .val{
        font-style:italic;
      }
      .key a, .val a{
        color:black;
        text-decoration:none;
      }
      .icon{
        display:block;
        float:right;
        text-decoration:none;
        padding-left:5px;
        color:blue;
      }
    </style>
    <script type="text/javascript" src="jquery-1.2.6.js"></script>
    <script type="text/javascript" src="json2.js"></script>
    <script type="text/javascript" src="jquery.timers.js"></script>
    <script type="text/javascript">
      function JSONEditorBase() {
        this.TAB_SIZE = 30;
      }
      
      function JSONEditor(wrapped) {
        var self = this;
        
        this.wrapped = $(wrapped);

        this.wrapped.wrap('<div class="container"></div>');
        this.container = $(this.wrapped.parent());

        this.builderTab = $('<li><a href="#">builder</a></li>').click(function(e) {
          self.rebuild(true);
          self.builder.show();
          self.wrapped.hide();
          return false;
        });
        
        this.textTab = $('<li><a href="#">text</a></li>').click(function(e) {
          self.rebuild();
          self.builder.hide();
          self.wrapped.show();
          return false;
        });
        
        this.debugTab = $('<li><a href="#">debug</a></li>').click(function(e) {
          self.inspect(self.container);
          return false;
        });
        
        this.tabs = $('<ul class="tabs"></ul>');
        this.tabs.append(this.builderTab);
        this.tabs.append(this.textTab);
        this.tabs.append(this.debugTab);
        this.container.prepend(this.tabs);
                
        this.container.width(this.wrapped.width()).height(this.wrapped.height() + this.TAB_SIZE);
        this.container.css("position", "relative");
        
        this.rebuild();
        
        return this;
      }
      JSONEditor.prototype = new JSONEditorBase();
      
      JSONEditor.prototype.BRACE = function(key, struct) {
        var self = this;
        return $('<a class="icon" href="#"><strong>{</strong></a>').click(function(e) {
          struct[key] = { "??": struct[key] };
          self.rebuild();
          return false;
        });
      };
      
      JSONEditor.prototype.BRACKET = function(key, struct) {
        var self = this;
        return $('<a class="icon" href="#"><strong>[</a>').click(function(e) {
          struct[key] = [ struct[key] ];
          self.rebuild();
          return false;
        });
      };
      
      JSONEditor.prototype.DELETE = function(key, struct, layerOnly) {
        var self = this;
        return $('<a class="icon" href="#"><img src="delete.png" border=0/></a>').click(function(e) {
          var didSomething = false;
          if (struct[key] instanceof Array) {
            if(struct[key].length > 0) {
              struct[key] = struct[key][0];
              didSomething = true;
            }
          } else if (struct[key] instanceof Object) {
            for (var i in struct[key]) {
              struct[key] = struct[key][i];
              didSomething = true;
              break;
            }
          }
          if (didSomething) {
            self.rebuild();
            return false;
          }
          if (struct instanceof Array) {
            struct.splice(key, 1);
          } else {
            delete struct[key];
          }
          self.rebuild();
          return false;
        });
      };
      
      JSONEditor.prototype.ADD = function(struct) {
        var self = this;
        return $('<a class="icon" href="#"><img src="add.png" border=0/></a>').click(function(e) {
          struct['??'] = '??';
          self.rebuild();
          return false;
        });
      };
      
      JSONEditor.prototype.storeToText = function() {
        this.wrapped.get(0).value = JSON.stringify(this.json, null, 2);
      };
      
      JSONEditor.prototype.rebuild = function(doNotRefreshText) {
        if (this.json && !doNotRefreshText) this.storeToText();
        this.cleanBuilder();
        this.json = JSON.parse(this.wrapped.get(0).value);
        this.alreadyFocused = false;
        this.build(this.json, this.builder);
      };
      
      JSONEditor.prototype.logJSON = function() {
        console.log(JSON.stringify(this.json, null, 2));
      };
      
      JSONEditor.prototype.cleanBuilder = function() {
        if (!this.builder) {
          this.builder = $('<div class="builder"></div>');
          this.container.append(this.builder);
        } else {
          this.builder.text('');
        }
        
        this.builder.css("position", "absolute").css("top", this.TAB_SIZE + "px").css("left", 0);
        this.builder.width(this.wrapped.width()).height(this.wrapped.height());
        
        this.wrapped.css("position", "absolute").css("top", this.TAB_SIZE + "px").css("left", 0);        
      };
      
      JSONEditor.prototype.edit = function(e, key, struct, kind){
        var self = this;
        var form = $("<form></form>").css('display', 'inline');
        var input = document.createElement("INPUT");
        input.value = e.text();
        var onblur = function() {
          var val = input.value;
          if(kind == 'key') {
            struct[val] = struct[key];
            if (key != val) delete struct[key];
          } else {
            struct[key] = val;
          }
          e.text(val);
          e.get(0).editing = false;
          if (key != val) self.rebuild();
          return false;
        };
        $(input).blur(onblur);
        $(form).submit(onblur).append(input);
        $(e).html(form);
        input.focus();
      };
      
      JSONEditor.prototype.inspect = function(e){
        var builder = this.builder.clone();
        $(".icon", builder).remove();
        $(".editable", builder).each(function(i){
          $(this).prepend('"');
          $(this).append('"');
        });
        var txt = builder.text();
        
        alert(txt);
      }
      
      JSONEditor.prototype.editable = function(text, key, struct, kind) {
        var self = this;
        var elem = $('<span class="editable" href="#"></span>').text(text).click(function(e) {
          if (!this.editing) {
            this.editing = true;
            self.edit($(this), key, struct, kind);
          }
          return true;
        });
        
        // Auto-edit '??' keys and values.
        if (text == '??' && !this.alreadyFocused) {
          this.alreadyFocused = true;
          elem.click();
          $(this).oneTime(100, function() { // Because JavaScript is annoying and we need to focus once the current stuff is done.
            elem.find('input').focus().select();
          });
        }
        return elem;
      }
      
      JSONEditor.prototype.build = function(json, node, parent, key) {
        if(json instanceof Array){
          var bq = $(document.createElement("BLOCKQUOTE"));
          var bq2 = $(document.createElement("BLOCKQUOTE"));
          bq.append($("<div>[</div>"));
          if (parent) bq.prepend(this.DELETE(key, parent));
          bq.append(bq2);
          for(var i = 0; i < json.length; i++) {
//            if (parent) bq.prepend(this.DELETE(key, parent));
            this.build(json[0], bq2, json, i);
          }
          bq.append($("<div>]</div>"));
          node.append(bq);
        } else if (json instanceof Object) {
          node.append($('<div>{</div>'));
          if (parent) node.prepend(this.DELETE(key, parent, true));
          node.prepend(this.ADD(json));
          var bq = $(document.createElement("BLOCKQUOTE"));
          node.append(bq);
          for(var i in json){
            var div = $('<div></div>');
            div.append(this.BRACE(i.toString(), json));
            div.append(this.BRACKET(i.toString(), json));
            div.append(this.editable(i.toString(), i.toString(), json, 'key').wrap('<b class="key"></b>').parent());
            div.append(document.createTextNode(': ')); 
            this.build(json[i], div, json, i);
            bq.append(div);
          }
          node.append($('<div>}</div>'));
        } else {
          if (parent) node.prepend(this.DELETE(key, parent));
          node.append(this.editable(json.toString(), key, parent, 'value').wrap('<span class="val"></span>').parent());
        }
      };
    </script>
    
    <script>
      $(document).ready(function(){
        var j = new JSONEditor($("#t"));
      });
    </script>
  </head>
  <body>
<textarea id="t">{
  "name": "a.title",
  "description": "foo.bar",
  "authors": [{
    "name": "p.foo",
    "link": "a | @href"
  }]
}
    </textarea>
  </body>  
</html>